#!/usr/bin/env node

/**
 * μ¤λ””μ¤ μƒμ„± ν…μ¤νΈ μ¤ν¬λ¦½νΈ
 * OpenAI TTS κΈ°λ¥μ„ ν…μ¤νΈν•κ³  μ¤λ””μ¤ νμΌμ„ μƒμ„±ν•©λ‹λ‹¤.
 */

import { generateAudioFile, previewAudioScript } from '../src/services/tts.js';
import { logger } from '../src/utils/logger.js';
import { getNowKST, formatDateKorean } from '../src/utils/dateUtils.js';
import path from 'path';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// ν…μ¤νΈ λ°μ΄ν„°
const testData = {
  date: formatDateKorean(getNowKST()),
  weather: {
    city: 'μ„μΈ',
    temperature: 15,
    description: 'λ§‘μ',
    fineDust: 'μΆ‹μ'
  },
  calendar: {
    today: [
      {
        summary: 'ν€ λ―Έν…',
        start: { dateTime: new Date('2026-02-12T10:00:00+09:00').toISOString() }
      },
      {
        summary: 'ν”„λ΅μ νΈ λ¦¬λ·°',
        start: { dateTime: new Date('2026-02-12T14:00:00+09:00').toISOString() }
      }
    ],
    tomorrow: [
      {
        summary: 'ν΄λΌμ΄μ–ΈνΈ λ―Έν…',
        start: { dateTime: new Date('2026-02-13T11:00:00+09:00').toISOString() }
      }
    ]
  },
  newsSummary: `
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π“ A) Macro Dashboard
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κΈ€λ΅λ² μ¦μ‹λ” Risk-on λ¶„μ„κΈ° μ† μƒμΉμ„Έλ¥Ό μ΄μ–΄κ°€κ³  μμµλ‹λ‹¤.
λ―Έκµ­ μ—°μ¤€μ κΈλ¦¬ λ™κ²° κΈ°μ΅°κ°€ μ΄μ–΄μ§€λ©° μ‹μ¥ μ•μ •μ„±μ΄ λ†’μ•„μ΅μµλ‹λ‹¤.
λ‹¬λ¬ μ•½μ„Έμ™€ μ κ°€ μ•μ •μ΄ μ‹ ν¥κµ­μ— μ°νΈμ μΈ ν™κ²½μ„ μ κ³µν•κ³  μμµλ‹λ‹¤.

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π”¥ B) Top Drivers
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

1οΈβƒ£ [λ―Έκµ­ κΈ°μ μ£Ό κ°•μ„Έ μ§€μ†]
   β€Ά ν•µμ‹¬: AI κ΄€λ ¨ κΈ°μ μ£Όλ“¤μ΄ μ‹¤μ  νΈμ΅°λ¥Ό λ³΄μ΄λ©° λ‚μ¤λ‹¥ μ§€μκ°€ μ‚¬μƒ μµκ³ μΉλ¥Ό κ²½μ‹ ν–μµλ‹λ‹¤. λΉ…ν…ν¬ κΈ°μ—…λ“¤μ ν΄λΌμ°λ“ λ¶€λ¬Έ μ„±μ¥μ΄ λ‘λ“λ¬μ§‘λ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ£Όμ‹(Tech), FX(λ‹¬λ¬)
   β€Ά λ§ν¬: https://news.example.com/tech-rally

2οΈβƒ£ [ν•κµ­ λ°λ„μ²΄ μμ¶ μ¦κ°€]
   β€Ά ν•µμ‹¬: 1μ›” λ°λ„μ²΄ μμ¶μ΄ μ „λ…„ λ€λΉ„ 30% μ¦κ°€ν•λ©° κ²½κΈ° νλ³µ κΈ°λ€κ°μ΄ λ†’μ•„μ§€κ³  μμµλ‹λ‹¤. λ©”λ¨λ¦¬ λ°λ„μ²΄ κ°€κ²© μƒμΉμ„Έκ°€ μ΄μ–΄μ§€κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ£Όμ‹(λ°λ„μ²΄), μ›ν™”
   β€Ά λ§ν¬: https://news.example.com/korea-semi

3οΈβƒ£ [μ λ½ μΈν”λ μ΄μ… λ‘”ν™”]
   β€Ά ν•µμ‹¬: μ λ΅μ΅΄ μ†λΉ„μλ¬Όκ°€ μƒμΉλ¥ μ΄ 2.5%λ΅ ν•λ½ν•λ©° ECB κΈλ¦¬ μΈν• κΈ°λ€κ°μ΄ μ»¤μ§€κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ±„κ¶(μ λ½), FX(μ λ΅)
   β€Ά λ§ν¬: https://news.example.com/eu-inflation

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π“ C) μΉ΄ν…κ³ λ¦¬λ³„ ν• μ¤„
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
[KR μ •μ±…] μ •λ¶€, λ°λ„μ²΄ μ„Έμ•΅κ³µμ  ν™•λ€ λ°©μ• λ°ν‘ μμ •
[KR κ²½μ /μ‹μ¥] μ½”μ¤ν”Ό 2,700μ„  νλ³µ, μ™Έκµ­μΈ λ§¤μμ„Έ μ§€μ†
[Tech] μ• ν”, μƒλ΅μ΄ AI κΈ°λ¥ νƒ‘μ¬ν• μ•„μ΄ν° λ°ν‘
[Global] μ¤‘κµ­ μ¶μ  μ—°ν΄ μ†λΉ„ νλ³µμ„Έ λλ ·
  `.trim()
};

async function main() {
  logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”');
  logger.info('π§ μ¤λ””μ¤ μƒμ„± ν…μ¤νΈ μ‹μ‘');
  logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”\n');

  try {
    // 1. μ¤ν¬λ¦½νΈ λ―Έλ¦¬λ³΄κΈ°
    logger.info('[1/2] μ¤λ””μ¤ μ¤ν¬λ¦½νΈ λ―Έλ¦¬λ³΄κΈ°\n');
    const script = previewAudioScript(testData);
    logger.info('β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€');
    logger.info(script);
    logger.info('β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€\n');

    // 2. μ¤λ””μ¤ νμΌ μƒμ„±
    logger.info('[2/2] μ¤λ””μ¤ νμΌ μƒμ„± μ¤‘...\n');
    const outputPath = path.join(__dirname, '..', 'docs', 'test-audio.mp3');
    
    const success = await generateAudioFile(testData, outputPath);

    if (success) {
      logger.info('\nβ”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”');
      logger.success('β… μ¤λ””μ¤ μƒμ„± ν…μ¤νΈ μ„±κ³µ!');
      logger.info(`π“ νμΌ μ„μΉ: ${outputPath}`);
      logger.info('πµ μ¬μƒν•μ—¬ ν™•μΈν•μ„Έμ”.');
      logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”\n');
      process.exit(0);
    } else {
      throw new Error('μ¤λ””μ¤ μƒμ„± μ‹¤ν¨');
    }

  } catch (error) {
    logger.error('\nβ μ¤λ””μ¤ μƒμ„± ν…μ¤νΈ μ‹¤ν¨', error);
    process.exit(1);
  }
}

main();
