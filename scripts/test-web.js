#!/usr/bin/env node

/**
 * μ›Ή νμ΄μ§€ μƒμ„± ν…μ¤νΈ μ¤ν¬λ¦½νΈ
 * μ›Ήμ© HTMLμ„ μƒμ„±ν•κ³  λ΅μ»¬μ—μ„ ν™•μΈν•©λ‹λ‹¤.
 */

import { generateWebPage, generateIndexPage } from '../src/output/generator.js';
import { logger } from '../src/utils/logger.js';
import { getNowKST, formatDateKorean } from '../src/utils/dateUtils.js';

// ν…μ¤νΈ λ°μ΄ν„°
const testData = {
  date: formatDateKorean(getNowKST()),
  weather: {
    city: 'μ„μΈ',
    temperature: 15,
    description: 'λ§‘μ',
    humidity: 65,
    windSpeed: 3.5,
    fineDust: 'μΆ‹μ',
    ultraFineDust: 'λ³΄ν†µ'
  },
  calendar: {
    today: [
      {
        summary: 'ν€ λ―Έν…',
        description: 'μ£Όκ°„ μ§„ν–‰μƒν™© κ³µμ ',
        start: { dateTime: new Date('2026-02-12T10:00:00+09:00').toISOString() },
        end: { dateTime: new Date('2026-02-12T11:00:00+09:00').toISOString() }
      },
      {
        summary: 'ν”„λ΅μ νΈ λ¦¬λ·°',
        start: { dateTime: new Date('2026-02-12T14:00:00+09:00').toISOString() },
        end: { dateTime: new Date('2026-02-12T15:30:00+09:00').toISOString() }
      }
    ],
    tomorrow: [
      {
        summary: 'ν΄λΌμ΄μ–ΈνΈ λ―Έν…',
        start: { dateTime: new Date('2026-02-13T11:00:00+09:00').toISOString() }
      }
    ]
  },
  gmail: `
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π“§ λ―Έμ½μ λ©”μΌ μ”μ•½ (μ΄ 3κ±΄)
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

1. From: GitHub
   Subject: [morningbriefv3] New PR merged
   What it is: ν”„λ΅μ νΈμ— μƒλ΅μ΄ PRμ΄ λ³‘ν•©λμ—μµλ‹λ‹¤
   Action: Review - λ³€κ²½μ‚¬ν•­ ν™•μΈ ν•„μ”

2. From: AWS Billing
   Subject: Your AWS bill is ready
   What it is: 1μ›” AWS μ‚¬μ© μ”κΈ κ³ μ§€μ„
   Action: Review - μμ‚° μ΄κ³Ό μ—¬λ¶€ ν™•μΈ

3. From: Newsletter
   Subject: Weekly Tech Updates
   What it is: μ£Όκ°„ κΈ°μ  λ‰΄μ¤λ ν„°
   Action: Track - λ‚μ¤‘μ— μ½κΈ°
  `.trim(),
  newsSummary: `
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π“ A) Macro Dashboard
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κΈ€λ΅λ² μ¦μ‹λ” Risk-on λ¶„μ„κΈ° μ† μƒμΉμ„Έλ¥Ό μ΄μ–΄κ°€κ³  μμµλ‹λ‹¤.
λ―Έκµ­ μ—°μ¤€μ κΈλ¦¬ λ™κ²° κΈ°μ΅°κ°€ μ΄μ–΄μ§€λ©° μ‹μ¥ μ•μ •μ„±μ΄ λ†’μ•„μ΅μµλ‹λ‹¤.
λ‹¬λ¬ μ•½μ„Έμ™€ μ κ°€ μ•μ •μ΄ μ‹ ν¥κµ­μ— μ°νΈμ μΈ ν™κ²½μ„ μ κ³µν•κ³  μμµλ‹λ‹¤.

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π”¥ B) Top Drivers (5κ°)
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

1οΈβƒ£ [λ―Έκµ­ κΈ°μ μ£Ό κ°•μ„Έ μ§€μ†]
   β€Ά ν•µμ‹¬: AI κ΄€λ ¨ κΈ°μ μ£Όλ“¤μ΄ μ‹¤μ  νΈμ΅°λ¥Ό λ³΄μ΄λ©° λ‚μ¤λ‹¥ μ§€μκ°€ μ‚¬μƒ μµκ³ μΉλ¥Ό κ²½μ‹ ν–μµλ‹λ‹¤. λΉ…ν…ν¬ κΈ°μ—…λ“¤μ ν΄λΌμ°λ“ λ¶€λ¬Έ μ„±μ¥μ΄ λ‘λ“λ¬μ§‘λ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ£Όμ‹(Tech), FX(λ‹¬λ¬)
   β€Ά λ§ν¬: https://news.example.com/tech-rally

2οΈβƒ£ [ν•κµ­ λ°λ„μ²΄ μμ¶ μ¦κ°€]
   β€Ά ν•µμ‹¬: 1μ›” λ°λ„μ²΄ μμ¶μ΄ μ „λ…„ λ€λΉ„ 30% μ¦κ°€ν•λ©° κ²½κΈ° νλ³µ κΈ°λ€κ°μ΄ λ†’μ•„μ§€κ³  μμµλ‹λ‹¤. λ©”λ¨λ¦¬ λ°λ„μ²΄ κ°€κ²© μƒμΉμ„Έκ°€ μ΄μ–΄μ§€κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ£Όμ‹(λ°λ„μ²΄), μ›ν™”
   β€Ά λ§ν¬: https://news.example.com/korea-semi

3οΈβƒ£ [μ λ½ μΈν”λ μ΄μ… λ‘”ν™”]
   β€Ά ν•µμ‹¬: μ λ΅μ΅΄ μ†λΉ„μλ¬Όκ°€ μƒμΉλ¥ μ΄ 2.5%λ΅ ν•λ½ν•λ©° ECB κΈλ¦¬ μΈν• κΈ°λ€κ°μ΄ μ»¤μ§€κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ±„κ¶(μ λ½), FX(μ λ΅)
   β€Ά λ§ν¬: https://news.example.com/eu-inflation

4οΈβƒ£ [μ¤‘κµ­ κ²½κΈ° λ¶€μ–‘μ±… λ°ν‘]
   β€Ά ν•µμ‹¬: μ¤‘κµ­ μ •λ¶€κ°€ λ€κ·λ¨ μΈν”„λΌ ν¬μ κ³„νμ„ λ°ν‘ν•λ©° μ›μμ¬ κ°€κ²©μ΄ μƒμΉν•κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ›μμ¬, μ£Όμ‹(μ² κ°•/κ±΄μ„¤)
   β€Ά λ§ν¬: https://news.example.com/china-stimulus

5οΈβƒ£ [μ„μ  κ°€κ²© μ•μ •]
   β€Ά ν•µμ‹¬: OPEC+ μƒμ‚°λ‰ λ™κ²° ν•©μλ΅ μ κ°€κ°€ λ°°λ΄λ‹Ή 75λ‹¬λ¬ μμ¤€μ—μ„ μ•μ •μ„Έλ¥Ό λ³΄μ΄κ³  μμµλ‹λ‹¤.
   β€Ά μ‹μ¥μν–¥: μ›μμ¬(μ—λ„μ§€), μΈν”λ μ΄μ…
   β€Ά λ§ν¬: https://news.example.com/oil-price

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
π“ C) μΉ΄ν…κ³ λ¦¬λ³„ ν• μ¤„
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
[KR μ •μ±…] μ •λ¶€, λ°λ„μ²΄ μ„Έμ•΅κ³µμ  ν™•λ€ λ°©μ• λ°ν‘ μμ •
[KR κ²½μ /μ‹μ¥] μ½”μ¤ν”Ό 2,700μ„  νλ³µ, μ™Έκµ­μΈ λ§¤μμ„Έ μ§€μ†
[Tech] μ• ν”, μƒλ΅μ΄ AI κΈ°λ¥ νƒ‘μ¬ν• μ•„μ΄ν° λ°ν‘
[Global] μ¤‘κµ­ μ¶μ  μ—°ν΄ μ†λΉ„ νλ³µμ„Έ λλ ·

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
β… D) μ¤λμ μ²΄ν¬ν¬μΈνΈ (3κ°)
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
1. [λ―Έκµ­ λΉ…ν…ν¬ μ‹¤μ  λ°ν‘]
   β€Ά μ‹λ‚λ¦¬μ¤ A: μμƒμΉ μƒν μ‹ λ‚μ¤λ‹¥ μ¶”κ°€ μƒμΉ κ°€λ¥
   β€Ά μ‹λ‚λ¦¬μ¤ B: κ°€μ΄λμ¤ λ¶€μ§„ μ‹ μ΅°μ • μ••λ ¥

2. [ν•κµ­ λ¬΄μ—­μμ§€]
   β€Ά μ‹λ‚λ¦¬μ¤ A: ν‘μ μ§€μ† μ‹ μ›ν™” κ°•μ„Έ μ”μΈ
   β€Ά μ‹λ‚λ¦¬μ¤ B: μ μ μ „ν™ μ‹ μ›ν™” μ•½μ„Έ μ°λ ¤

3. [μ λ½ ECB μ •μ±… νμ]
   β€Ά μ‹λ‚λ¦¬μ¤ A: κΈλ¦¬ μΈν• μ‹μ‚¬ μ‹ μ λ΅ μ•½μ„Έ
   β€Ά μ‹λ‚λ¦¬μ¤ B: λ™κ²° μ μ§€ μ‹ ν„ μμ¤€ μ μ§€
  `.trim()
};

async function main() {
  logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”');
  logger.info('π μ›Ή νμ΄μ§€ μƒμ„± ν…μ¤νΈ μ‹μ‘');
  logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”\n');

  try {
    // 1. μΈλ±μ¤ νμ΄μ§€ μƒμ„±
    logger.info('[1/2] μΈλ±μ¤ νμ΄μ§€ μƒμ„± μ¤‘...');
    const indexPath = await generateIndexPage();
    logger.success(`β“ μΈλ±μ¤ νμ΄μ§€ μƒμ„± μ™„λ£: ${indexPath}\n`);

    // 2. λΈλ¦¬ν•‘ νμ΄μ§€ μƒμ„±
    logger.info('[2/2] λΈλ¦¬ν•‘ νμ΄μ§€ μƒμ„± μ¤‘...');
    const webPath = await generateWebPage(testData, './test-audio.mp3');
    logger.success(`β“ λΈλ¦¬ν•‘ νμ΄μ§€ μƒμ„± μ™„λ£: ${webPath}\n`);

    logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”');
    logger.success('β… μ›Ή νμ΄μ§€ μƒμ„± ν…μ¤νΈ μ„±κ³µ!');
    logger.info('\nμƒμ„±λ νμΌ:');
    logger.info(`  β€Ά ${indexPath}`);
    logger.info(`  β€Ά ${webPath}`);
    logger.info('\nλΈλΌμ°μ €μ—μ„ ν™•μΈν•μ„Έμ”.');
    logger.info('β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”\n');

    process.exit(0);

  } catch (error) {
    logger.error('\nβ μ›Ή νμ΄μ§€ μƒμ„± ν…μ¤νΈ μ‹¤ν¨', error);
    process.exit(1);
  }
}

main();
